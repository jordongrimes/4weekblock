document.addEventListener('DOMContentLoaded', function () {
    const plan = {
        "Week 1": { "Monday": { am: { title: "Full Body Strength (Lower Focus)", purpose: "To build foundational lower body strength, which is the engine for rucking, running, and lifting. The goal is to successfully complete all 5 sets of the Tier 1 Sandbag Squats at the prescribed RPE without form breaking down.", cues: "On the Sandbag Squats, focus on keeping your chest up and bracing your core as if you're about to take a punch. Use the rest in the E3MOM to fully recover; these are strength sets, not conditioning.", workout: "<div class='workout-component'><strong>0:00-5:00 | Warm-up:</strong> AMRAP in 5 min: 10 Bodyweight Squats, 10 Glute Bridges, 5 Inchworms.</div><div class='workout-component'><strong>5:00-20:00 | Tier 1:</strong> E3MOM for 15 min (5 sets): 5 Sandbag Front Squats @ <strong>RPE 7-8</strong>.</div><div class='workout-component'><strong>20:00-35:00 | Tier 2:</strong> AMRAP in 15 min: 8 DB Bench Press (30s), 10 Single-Arm DB Rows (40/50lb) per side.</div><div class='workout-component'><strong>35:00-43:00 | Tier 3:</strong> EMOM for 8 min: Odd Mins: 3-5 Controlled Negative Pull-ups (5s descent). Even Mins: 30s Side Plank (alternating).</div><div class='workout-component'><strong>43:00-45:00 | Cool-down:</strong> 60s Kneeling Hip Flexor Stretch, 60s Pigeon Pose.</div>" }, pm: { title: "Track Run", purpose: "To increase your lactate threshold, which allows you to hold a faster pace for longer before fatiguing. The goal is to keep all 6 intervals within the target HR Zone 4 and make the last rep feel as strong as the first.", cues: "Focus on running 'tall' with a slight forward lean from the ankles. Use the 90-second rest to walk and bring your heart rate down. Don't start the next interval until you feel mentally and physically ready.", workout: "<div class='workout-component'><strong>Mission:</strong> Threshold Intervals</div><div class='workout-component'><strong>Workout:</strong> 6 x 400m Repeats in <strong>HR Zone 4 (176-184 bpm)</strong>, with 90s rest between each.</div>" }, optional: { title: "Resilience Module", workout: "<div class='workout-component'><strong>Focus:</strong> Block 1B: Lower Body Mobility & Activation.</div><div class='workout-component'><strong>Drill:</strong> 3 Rounds: 10 Glute Bridges, 10 Fire Hydrants per side, 30s Deep Squat Hold.</div>"} },
            "Tuesday": { am: { title: "Body Armor", purpose: "To build 'chassis integrity' – the muscular endurance and core stability required to carry awkward, heavy loads without injury. The goal is to complete as many rounds as possible in 35 minutes with minimal breaks and perfect posture on the carries.", cues: "For the Bear Hug Carry, keep the sandbag high on your chest to engage your upper back and prevent slouching. Find a steady, deliberate pace you can maintain for the entire workout. This is a mental grind; focus on one rep at a time.", workout: "<div class='workout-component'><strong>0:00-5:00 | Warm-up:</strong> AMRAP in 5 min: 30s Jump Rope, 10 Band Pull-Aparts, 20m Bear Crawl.</div><div class='workout-component'><strong>5:00-40:00 | Main Work:</strong> AMRAP in 35 min: 50m Sandbag Bear Hug Carry (75-100 lbs), 10 Sandbag Zercher Squats, 10 HRPU, 60s Plank Hold.</div><div class='workout-component'><strong>40:00-45:00 | Cool-down:</strong> 60s Child's Pose, 60s passive Dead Hang.</div>" }, pm: { title: "Optional HIIT", purpose: "To rapidly improve your anaerobic threshold and VO2 max. This is a high-intensity, short-duration session to maximize cardiovascular adaptation. The goal is a maximum effort sprint every time.", cues: "The 15-second sprints should be all-out, leaving you breathless. Use the 45-second recovery to actively slow your breathing and prepare for the next effort.", workout: "<div class='workout-component'><strong>Assault Bike Option:</strong> EMOM for 20 min: Odd Mins: 15s MAX EFFORT sprint. Even Mins: 45s easy spin.</div><div class='workout-component'><strong>Rower Option:</strong> 8 RFT: 250m Row Sprint, Rest 60s.</div>" }, optional: { title: "Resilience Module", workout: "<div class='workout-component'><strong>Focus:</strong> Block 1A: Upper Body Mobility & Activation.</div><div class='workout-component'><strong>Drill:</strong> 3 Rounds: 10 Band Pull-Aparts, 10 Scapular Push-ups, 5 Thoracic Rotations per side.</div>"} },
            "Wednesday": { am: { title: "Full Body Strength (Upper Focus)", purpose: "To develop upper body pressing power and endurance. The complex in Tier 1 builds both strength and muscular stamina. The goal is to complete all 10 sets of the complex without needing to drop the weight.", cues: "In the Tier 1 EMOM, focus on an explosive drive on the push press, using your legs to move the weight. The rest minute is crucial; use it to recover completely. On the Ring Rows, pause for a second at the top, squeezing your shoulder blades together.", workout: "<div class='workout-component'><strong>0:00-5:00 | Warm-up:</strong> 2 Rds: 30s Arm Circles, 10 Scapular Pulls, 5 Inchworms.</div><div class='workout-component'><strong>5:00-25:00 | Tier 1:</strong> EMOM for 20 min (10 rds): Min 1: 3 DB Push Press + 5 DB Bench Press (30s) @ <strong>RPE 8</strong>. Min 2: Rest.</div><div class='workout-component'><strong>25:00-40:00 | Tier 2:</strong> AMRAP in 15 min: 8 Sandbag Good Mornings, 40 Double-Unders.</div><div class='workout-component'><strong>40:00-45:00 | Tier 3:</strong> 3 Sets For Quality: 10-20s Active Hang Hold, Max Reps Ring Rows. Rest 60s.</div>" }, pm: { title: "Track Run", purpose: "To improve aerobic efficiency and teach your body to comfortably run at a moderately high intensity. This is a 'comfortably hard' effort. The goal is to stay within the prescribed HR zones for the full duration.", cues: "During the Zone 3 segment, focus on smooth, rhythmic breathing. This shouldn't feel like a sprint. It's about sustaining a strong pace. Monitor your heart rate closely during the transitions between zones.", workout: "<div class='workout-component'><strong>Mission:</strong> Tempo Run</div><div class='workout-component'><strong>Workout:</strong> 30 min total: 10 min <strong>HR Zone 2</strong>, 10 min <strong>HR Zone 3</strong>, 10 min <strong>HR Zone 2</strong>.</div>" }, optional: { title: "Resilience Module", workout: "<div class='workout-component'><strong>Focus:</strong> Block 1C: Full Body Mobility & Activation.</div><div class='workout-component'><strong>Drill:</strong> 3 Rounds: 5 Inchworms, 10 Air Squats, 30s Dead Hang.</div>"} },
            "Thursday": { am: { title: "Active Recovery Ruck", purpose: "To build your aerobic base and condition your feet, back, and shoulders for carrying a load over distance. This session should facilitate recovery, not add fatigue. The goal is to keep your heart rate in Zone 2 for the entire duration.", cues: "Focus on good posture: chest proud, shoulders back, and core engaged. Use this session to dial in your pack setup and identify any potential friction spots. Practice nasal breathing to stay in the proper HR zone.", workout: "<div class='workout-component'><strong>Mission:</strong> Endurance & Structural Adaptation</div><div class='workout-component'><strong>Workout:</strong> Ruck for 60 minutes with 35 lbs in <strong>HR Zone 2 (158-165 bpm)</strong>.</div>" }, pm: { title: "Optional HIIT", purpose: "To challenge your metabolic conditioning with a short, intense workout that tests your ability to work through fatigue. The goal is to minimize transition time between movements and maintain a high work rate.", cues: "This is a sprint. Pace the first round at about 85-90% effort to learn how it feels, then push the remaining rounds. Focus on efficient movement to save energy.", workout: "<div class='workout-component'><strong>Assault Bike Option:</strong> 10 min AMRAP: 15 cal Bike, 10 Air Squats, 5 Burpees.</div><div class='workout-component'><strong>Rower Option:</strong> For Time: 1000m Row, Rest 3 min, 750m Row, Rest 2 min, 500m Row.</div>" }, optional: { title: "Resilience Module", workout: "<div class='workout-component'><strong>Focus:</strong> Ruck-specific Neck/Lats.</div><div class='workout-component'><strong>Drill:</strong> 3 Rounds: 12 DB Shrugs, 30s Neck Isometrics, 10 Ring Rows.</div>"} },
            "Friday": { am: { title: "Full Body Strength (Hinge Focus)", purpose: "To develop strength and power in the posterior chain (hamstrings, glutes, back), which is critical for deadlifts, explosive movements, and injury prevention. The goal for Tier 1 is to execute each deadlift with perfect, safe form.", cues: "On the Vitruvian Deadlifts, initiate the pull by driving your feet through the floor. Keep your back flat and chest up. For the '21-15-9' workout, break up the reps from the beginning to avoid redlining. For example, do the 21 snatches as 8-7-6.", workout: "<div class='workout-component'><strong>0:00-5:00 | Warm-up:</strong> EMOM for 5 min: 10 KB Swings, 10 Bird-Dogs.</div><div class='workout-component'><strong>5:00-20:00 | Tier 1:</strong> E2MOM for 15 min (7 sets): 5 Vitruvian Deadlifts @ <strong>RPE 8</strong>.</div><div class='workout-component'><strong>20:00-35:00 | Tier 2:</strong> For Time (15-min cap): 21-15-9 reps of: Alt. DB Snatches (40lb), Box Jumps (24\").</div><div class='workout-component'><strong>35:00-43:00 | Tier 3:</strong> AMRAP in 8 min: 3-5 Controlled Negative Pull-ups (5s), 10 V-Ups.</div><div class='workout-component'><strong>43:00-45:00 | Cool-down:</strong> 60s Seated Hamstring Stretch, 60s Child's Pose.</div>" }, pm: { title: "Run", purpose: "To build aerobic endurance and mental fortitude. This is a classic 'long slow distance' (LSD) run to improve your body's ability to use fat for fuel and handle sustained effort. The goal is to finish feeling steady and controlled, not exhausted.", cues: "Keep the effort conversational. You should be able to speak in short sentences. Focus on maintaining a consistent rhythm and cadence throughout the run. This is about time on your feet, not speed.", workout: "<div class='workout-component'><strong>Mission:</strong> Endurance</div><div class='workout-component'><strong>Workout:</strong> Run for 45 minutes in <strong>HR Zone 2 (158-165 bpm)</strong>.</div>" }, optional: { title: "Resilience Module", workout: "<div class='workout-component'><strong>Focus:</strong> Block 1B: Lower Body Mobility & Activation.</div><div class='workout-component'><strong>Drill:</strong> 3 Rounds: 10 Glute Bridges, 10 Fire Hydrants per side, 30s Deep Squat Hold.</div>"} } },
        "Week 2": { "Monday": { am: { title: "Full Body Strength (Upper Focus)", purpose: "To increase upper body strength and work capacity by increasing total volume on the primary lift. The goal is to maintain RPE 8 across all 8 sets of the bench press.", cues: "For the Dumbbell Bench Press, drive your feet into the floor and keep your shoulder blades pulled back and down. This creates a stable platform to press from. Pace the Tier 2 AMRAP; don't go out too fast on the Box Jumps.", workout: "<div class='workout-component'><strong>0:00-5:00 | Warm-up:</strong> AMRAP 5 min: 10 Scapular Push-ups, 10 Banded External Rotations/side, 30s Jump Rope.</div><div class='workout-component'><strong>5:00-21:00 | Tier 1:</strong> E2MOM for 16 min (8 sets): 5 DB Bench Press @ <strong>RPE 8</strong>.</div><div class='workout-component'><strong>21:00-36:00 | Tier 2:</strong> AMRAP 15 min: 10 DB RDLs (30s), 10 Box Jumps (24\").</div><div class='workout-component'><strong>36:00-43:00 | Tier 3:</strong> 4 Sets For Quality: 3 Controlled Negative Pull-ups (5s) + 10s iso-hold at mid-range. Rest 60s.</div><div class='workout-component'><strong>43:00-45:00 | Cool-down:</strong> 60s Pec Stretch, 60s Lat Stretch.</div>" }, pm: { title: "Track Run", purpose: "To progress the lactate threshold work by adding another interval. This increases your ability to handle repeated high-intensity efforts. The goal is to maintain pace and form on the 7th interval, resisting the urge to slow down.", cues: "Your pacing should be consistent. The first 400m shouldn't be significantly faster than the last. Use your arms to drive your legs when you feel fatigued.", workout: "<div class='workout-component'><strong>Mission:</strong> Threshold Intervals</div><div class='workout-component'><strong>Workout:</strong> 7 x 400m Repeats in <strong>HR Zone 4 (176-184 bpm)</strong>, with 90s rest.</div>" }, optional: { title: "Resilience Module", workout: "<div class='workout-component'><strong>Focus:</strong> Block 1A: Upper Body Mobility & Activation.</div><div class='workout-component'><strong>Drill:</strong> 3 Rounds: 10 Band Pull-Aparts, 10 Scapular Push-ups, 5 Thoracic Rotations per side.</div>"} }, "Tuesday": { am: { title: "Body Armor", purpose: "To build grip strength, core stability, and mental toughness through a high-intensity 'for time' workout. This session is about pure grit. The goal is to complete all 5 rounds, taking only the prescribed rest.", cues: "On the Farmer's Carry, stand tall, pack your shoulders, and take fast, choppy steps. For the Bear Hug Carry, lock your hands and pull the bag tightly into your chest. Breathe deliberately during the carries; don't hold your breath.", workout: "<div class='workout-component'><strong>0:00-5:00 | Warm-up:</strong> 2 Rds: 10 KB Halos, 20m Farmer's Carry (light), 10 BW Good Mornings.</div><div class='workout-component'><strong>5:00-40:00 | Main Work:</strong> 5 RFT (35-min cap): 50m DB Farmer's Carry (heavy), 50m Sandbag Bear Hug Carry (75-100 lbs), 12 HRPU. <em>Rest 60s between rounds.</em></div><div class='workout-component'><strong>40:00-45:00 | Cool-down:</strong> 90s Spider-Man Lunge w/ Thoracic Rotation, 60s Wrist/Forearm Stretches.</div>" }, pm: { title: "Optional HIIT", purpose: "A short, sharp anaerobic power test. This style of workout improves your ability to produce a high power output and recover quickly. The goal is to negative split—make the final set the fastest one.", cues: "The first set of 30 calories should feel hard but controlled. The final set of 10 should be an all-out sprint from the first second. Use the rest period to get your breathing under control.", workout: "<div class='workout-component'><strong>Assault Bike Option:</strong> For Time: 30-20-10 calories. Rest 2 minutes between sets.</div><div class='workout-component'><strong>Rower Option:</strong> EMOM for 18 min: Odd: 12-cal Row. Even: 12 Burpees.</div>" }, optional: { title: "Resilience Module", workout: "<div class='workout-component'><strong>Focus:</strong> Block 1C: Full Body Mobility & Activation.</div><div class='workout-component'><strong>Drill:</strong> 3 Rounds: 5 Inchworms, 10 Air Squats, 30s Dead Hang.</div>"} }, "Wednesday": { am: { title: "Full Body Strength (Hinge Focus)", purpose: "To develop power-endurance in the posterior chain. Combining a heavy lift with a dynamic bodyweight movement in an AMRAP format challenges both strength and conditioning. The goal is to complete 8+ rounds.", cues: "Prioritize a flat back on every Sandbag Deadlift rep. Drop and reset if your form breaks. Step, don't jump, back on the burpees to conserve energy for the deadlifts.", workout: "<div class='workout-component'><strong>0:00-5:00 | Warm-up:</strong> AMRAP 5 min: 10 KB Swings, 10 Glute Bridges, 30s Jump Rope.</div><div class='workout-component'><strong>5:00-25:00 | Tier 1:</strong> AMRAP 20 min: 3 Heavy Sandbag Deadlifts @ <strong>RPE 8</strong>, 5 Burpees over the bag.</div><div class='workout-component'><strong>25:00-40:00 | Tier 2:</strong> AMRAP 15 min: 8 KB Goblet Squats (35lb), 10 Ring Rows.</div><div class='workout-component'><strong>40:00-45:00 | Tier 3:</strong> For Time: Accumulate 2 min in a Plank Hold. (Penalty for break: 5 V-Ups).</div>" }, pm: { title: "Track Run", purpose: "To increase the duration of your aerobic base run. This session adds time-on-feet, improving running economy and cardiovascular efficiency. The goal is to maintain a steady Zone 2 heart rate for the entire 35 minutes.", cues: "Settle into a rhythm early on. This is a 'forever pace.' Focus on your breathing and try to link it to your cadence (e.g., two steps on the inhale, two steps on the exhale).", workout: "<div class='workout-component'><strong>Mission:</strong> Endurance</div><div class='workout-component'><strong>Workout:</strong> Run for 35 minutes in <strong>HR Zone 2 (158-165 bpm)</strong>.</div>" }, optional: { title: "Resilience Module", workout: "<div class='workout-component'><strong>Focus:</strong> Block 1B: Lower Body Mobility & Activation.</div><div class='workout-component'><strong>Drill:</strong> 3 Rounds: 10 Glute Bridges, 10 Fire Hydrants per side, 30s Deep Squat Hold.</div>"} }, "Thursday": { am: { title: "Active Recovery Ruck", purpose: "To continue building rucking volume and endurance. The extra 10 minutes this week pushes your structural adaptation further. The goal is a steady, uninterrupted 70 minutes in Zone 2.", cues: "Use this longer ruck to practice your nutrition and hydration strategy. Take a few sips of water every 15 minutes. Maintain a powerful arm swing to help propel you forward.", workout: "<div class='workout-component'><strong>Mission:</strong> Endurance & Structural Adaptation</div><div class='workout-component'><strong>Workout:</strong> Ruck for 70 minutes with 35 lbs in <strong>HR Zone 2</strong>.</div>" }, pm: { title: "Optional HIIT", purpose: "Classic high-intensity interval format (Tabata) designed to maximize VO2 max improvement in a very short time. The goal is to push as hard as possible during the 20-second work intervals.", cues: "The 10-second rest is just enough time to transition. Have your space set up beforehand. Be explosive on the bike sprints and air squats. The last two rounds should feel nearly impossible.", workout: "<div class='workout-component'><strong>Assault Bike Option:</strong> Tabata (8 rds of 20s on / 10s off). Alternate Max Calorie Sprint and Air Squats.</div><div class='workout-component'><strong>Rower Option:</strong> 5 RFT: 150m Row Sprint, 10 KB Swings.</div>" }, optional: { title: "Resilience Module", workout: "<div class='workout-component'><strong>Focus:</strong> Run Stability.</div><div class='workout-component'><strong>Drill:</strong> 3 Rounds: 10 Single Leg Glute Bridges per side, 10 Banded Lateral Walks per side, 30s Single Leg Balance per side.</div>"} }, "Friday": { am: { title: "Full Body Strength (Lower Focus)", purpose: "To build muscular endurance and mental toughness in the lower body. The descending ladder format forces you to work through accumulating fatigue with very little rest. The goal is to finish the ladder under the 15-minute time cap.", cues: "Break up the early sets (10 and 9) if you need to, but try to go unbroken on the later sets. Focus on a powerful hip drive out of the bottom of the Zercher Squat. Use the single-arm work in Tier 2 to challenge your core stability.", workout: "<div class='workout-component'><strong>0:00-5:00 | Warm-up:</strong> 2 Rds: 20 Jumping Jacks, 10 Cossack Squats, 30s Deep Squat Hold.</div><div class='workout-component'><strong>5:00-20:00 | Tier 1:</strong> Ladder For Time (15-min cap): 10-9-8-7-6-5-4-3-2-1 reps of Sandbag Zercher Squats. (Penalty: 2 Box Jumps after each set).</div><div class='workout-component'><strong>20:00-35:00 | Tier 2:</strong> AMRAP 15 min: 8 Single-Arm DB Press/side (30/40lb), 10 Single-Arm DB Rows/side (50lb).</div><div class='workout-component'><strong>35:00-43:00 | Tier 3:</strong> EMOM for 8 min: Odd: 4 Controlled Negative Pull-ups (5s). Even: Max Reps Ring Rows in 30s.</div><div class='workout-component'><strong>43:00-45:00 | Cool-down:</strong> 60s Couch Stretch, 60s Pigeon Pose.</div>" }, pm: { title: "Ruck", purpose: "To introduce intensity into your rucking. This session teaches you to move faster with weight, bridging the gap between endurance rucking and AFT test-day pace. The goal is to keep your HR in the upper Z2/low Z3 range.", cues: "This is not a Zone 2 stroll. Shorten your stride, increase your cadence (steps per minute), and use your arms aggressively. This should feel 'comfortably uncomfortable.'", workout: "<div class='workout-component'><strong>Mission:</strong> Endurance with Intensity</div><div class='workout-component'><strong>Workout:</strong> Ruck for 50 minutes with 35 lbs in <strong>upper Zone 2 / low Zone 3 (164-168 bpm)</strong>.</div>" }, optional: { title: "Resilience Module", workout: "<div class='workout-component'><strong>Focus:</strong> Block 1B: Lower Body Mobility & Activation.</div><div class='workout-component'><strong>Drill:</strong> 3 Rounds: 10 Glute Bridges, 10 Fire Hydrants per side, 30s Deep Squat Hold.</div>"} } },
        "Week 3": { "Monday": { am: { title: "Full Body Strength (Hinge Focus)", purpose: "To develop unilateral posterior chain strength and stability. Single-leg work is crucial for identifying and fixing imbalances, which enhances running and rucking durability. The goal is perfect form on every rep of the RDLs.", cues: "For the Single Leg RDLs, keep a slight bend in your standing knee and hinge at the hip as if you're trying to touch the wall behind you with your butt. Move slowly and control the weight. The Tier 2 triplet is a sprint; move fast and breathe hard.", workout: "<div class='workout-component'><strong>0:00-5:00 | Warm-up:</strong> AMRAP 5 min: 10 KB Swings, 10 BW Good Mornings, 30s Butt Kicks.</div><div class='workout-component'><strong>5:00-21:00 | Tier 1:</strong> E2MOM for 16 min (8 sets): 8 DB RDLs per leg @ <strong>RPE 8</strong>. Alternate legs each round.</div><div class='workout-component'><strong>21:00-36:00 | Tier 2:</strong> 5 RFT (15-min cap): 8 DB Push Press (30s), 8 Box Jump Overs, 8 HRPU.</div><div class='workout-component'><strong>36:00-43:00 | Tier 3:</strong> 4 Sets For Quality: 4 Controlled Negative Pull-ups (5s) + 12s iso-hold at mid-range. Rest 60s.</div><div class='workout-component'><strong>43:00-45:00 | Cool-down:</strong> 60s Seated Hamstring Stretch, 60s Child's Pose.</div>" }, pm: { title: "Track Run", purpose: "A significant progression in lactate threshold training. By increasing the reps to 8 and decreasing the rest, you force your body to become much more efficient at clearing lactate and recovering between efforts. The goal is to survive and hit your paces.", cues: "The shorter rest is the real challenge. Focus on deep, calming breaths the second you finish an interval. Do not sit down. Walk slowly and prepare for the next effort.", workout: "<div class='workout-component'><strong>Mission:</strong> Threshold Intervals</div><div class='workout-component'><strong>Workout:</strong> 8 x 400m Repeats in <strong>HR Zone 4</strong>, with 75s rest.</div>" }, optional: { title: "Resilience Module", workout: "<div class='workout-component'><strong>Focus:</strong> Block 1B: Lower Body Mobility & Activation.</div><div class='workout-component'><strong>Drill:</strong> 3 Rounds: 10 Glute Bridges, 10 Fire Hydrants per side, 30s Deep Squat Hold.</div>"} }, "Tuesday": { am: { title: "Body Armor", purpose: "To target muscular endurance in key tactical movements (pulling and pressing) while under cardiovascular duress from the carry. The goal is to accumulate high reps on the max-rep stations by working for the full 45 seconds.", cues: "On the 'max reps' stations, the goal is not to sprint for 15 seconds and rest for 30. Find a steady pace you can maintain for the entire 45-second window. This builds true endurance, not just power.", workout: "<div class='workout-component'><strong>0:00-5:00 | Warm-up:</strong> AMRAP 5 min: 10 Sandbag Rows, 10 Air Squats, 5 Walk-outs.</div><div class='workout-component'><strong>5:00-40:00 | Main Work:</strong> AMRAP 35 min: 50m Sandbag Carry (any style), Max Reps Ring Rows in 45s, 15 V-Ups, Max Reps HRPU in 45s.</div><div class='workout-component'><strong>40:00-45:00 | Cool-down:</strong> 90s Dead Hang (accumulated), 60s Prayer Stretch.</div>" }, pm: { title: "Optional HIIT", purpose: "A test of grit and pacing. This workout forces you to manage two different energy systems simultaneously. The goal is to finish the 100 calories as quickly as possible by being efficient with your transitions.", cues: "The penalty swings are designed to break your rhythm. Perform them with crisp, powerful hip snaps, then get right back on the bike. Don't waste time.", workout: "<div class='workout-component'><strong>Assault Bike Option:</strong> Accumulate 100 calories for time. Every 2 min (starting at 0:00), perform 10 KB Swings.</div><div class='workout-component'><strong>Rower Option:</strong> 30s ON / 30s OFF for 20 minutes.</div>" }, optional: { title: "Resilience Module", workout: "<div class='workout-component'><strong>Focus:</strong> Block 1C: Full Body Mobility & Activation.</div><div class='workout-component'><strong>Drill:</strong> 3 Rounds: 5 Inchworms, 10 Air Squats, 30s Dead Hang.</div>"} }, "Wednesday": { am: { title: "Full Body Strength (Lower Focus)", purpose: "To develop high-level work capacity using a complex movement ladder. This challenges your technique, strength, and conditioning all at once. The goal is to complete the workout, maintaining clean reps on the Hang Cleans.", cues: "On the Sandbag Hang Clean, focus on an explosive hip extension ('jump') to get the bag weightless before pulling yourself under it. For the Tier 2 ring rows, elevating your feet makes them significantly harder; focus on a rigid body line from heels to head.", workout: "<div class='workout-component'><strong>0:00-5:00 | Warm-up:</strong> 2 Rds: 10 Sandbag Good Mornings (light), 10 Bulgarian Split Squat Hops/side, 30s Pogo Hops.</div><div class='workout-component'><strong>5:00-25:00 | Tier 1:</strong> Ladder For Time (20-min cap): 10-8-6-4-2 reps of complex (1 Sandbag Hang Clean + 1 Sandbag Front Squat). Penalty: 10 Alt. DB Snatches after each set.</div><div class='workout-component'><strong>25:00-40:00 | Tier 2:</strong> AMRAP 15 min: 8 DB Floor Press (40/50lb), 10 Ring Rows (feet elevated).</div><div class='workout-component'><strong>40:00-45:00 | Tier 3:</strong> For Time: 50 Double-Unders, 25 HRPU, 50 Double-Unders.</div>" }, pm: { title: "Track Run", purpose: "To push the duration of your aerobic base run to 40 minutes, further improving cardiovascular efficiency and endurance. The goal is to maintain a conversational pace and stay in Zone 2.", cues: "At this longer duration, you may start to feel mental fatigue. Use landmarks to break the run into smaller, manageable chunks. Stay relaxed and focus on efficient form.", workout: "<div class='workout-component'><strong>Mission:</strong> Endurance</div><div class='workout-component'><strong>Workout:</strong> Run for 40 minutes in <strong>HR Zone 2</strong>.</div>" }, optional: { title: "Resilience Module", workout: "<div class='workout-component'><strong>Focus:</strong> Block 1A: Upper Body Mobility & Activation.</div><div class='workout-component'><strong>Drill:</strong> 3 Rounds: 10 Band Pull-Aparts, 10 Scapular Push-ups, 5 Thoracic Rotations per side.</div>"} }, "Thursday": { am: { title: "Active Recovery Ruck", purpose: "The longest ruck of the block, aimed at cementing your aerobic and structural adaptations. This builds significant mental and physical resilience for WOCS. The goal is an uninterrupted 75 minutes in Zone 2.", cues: "Check your feet post-ruck for any hotspots or blisters. Address them now. This is a great time to test different socks or anti-chafing products.", workout: "<div class='workout-component'><strong>Mission:</strong> Endurance & Structural Adaptation</div><div class='workout-component'><strong>Workout:</strong> Ruck for 75 minutes with 35 lbs in <strong>HR Zone 2</strong>.</div>" }, pm: { title: "Optional HIIT", purpose: "To build your ability to repeat efforts at a high intensity with incomplete rest. This is a powerful VO2 max stimulus. The goal is to hit the calorie targets each round.", cues: "This EMOM is designed to get progressively harder. Pace the first minute so you have enough energy for the third minute. The fourth minute is your only chance to fully recover.", workout: "<div class='workout-component'><strong>Assault Bike Option:</strong> EMOM for 16 min (4 Rds): Min 1: 10 cals, Min 2: 12 cals, Min 3: 15 cals, Min 4: REST.</div><div class='workout-component'><strong>Rower Option:</strong> For Time: 2000m Row, but every 500m, do 15 Air Squats.</div>" }, optional: { title: "Resilience Module", workout: "<div class='workout-component'><strong>Focus:</strong> Grip Strength.</div><div class='workout-component'><strong>Drill:</strong> 3 Rounds: Max time Dead Hang. Rest 30s. Max time Farmer's Hold (heavy). Rest 90s.</div>"} }, "Friday": { am: { title: "Full Body Strength (Upper Focus)", purpose: "To build explosive upper body power and stability, particularly in a single-arm format which challenges the core. The goal is to maintain the complex's integrity and speed across all 10 rounds without significant form degradation.", cues: "For the Push Jerk, think about aggressively dipping and driving with your legs, then receiving the dumbbell with a locked-out arm in a slight squat. The movement is driven by the hips, not the arm. Keep your non-working arm out for balance.", workout: "<div class='workout-component'><strong>0:00-5:00 | Warm-up:</strong> AMRAP 5 min: 5 Scapular Pull-ups, 5 Light DB Push Press/side (30lb), 30s Jump Rope.</div><div class='workout-component'><strong>5:00-25:00 | Tier 1:</strong> EMOM for 20 min (10 rds): Min 1: 1 DB Push Press + 2 DB Push Jerks per arm (30lb). Alt arms each round. Min 2: Rest.</div><div class='workout-component'><strong>25:00-40:00 | Tier 2:</strong> AMRAP 15 min: 10 DB Goblet Squats (50lb), 10 Sandbag Good Mornings.</div><div class='workout-component'><strong>40:00-45:00 | Tier 3:</strong> For Time: 30m Sandbag Bear Hug Carry, 20 Burpees, 30m Sandbag Bear Hug Carry.</div>" }, pm: { title: "Run", purpose: "To improve your running efficiency and ability to change gears. A true Fartlek ('speed play') is unstructured and teaches you to accelerate and recover based on feel rather than a watch, which is a critical tactical skill. The goal is to listen to your body and have fun with the speed.", cues: "Leave your watch at home or ignore the lap button. Pick landmarks (a specific tree, a lamppost, the top of a hill) and vary your effort. Example: Jog for a few minutes to warm up, then sprint to the next street sign. Jog to recover. Run at a hard tempo pace for two blocks. Walk to recover. Repeat this pattern for the full duration.", workout: "<div class='workout-component'><strong>Mission:</strong> Fartlek Run (Speed Play)</div><div class='workout-component'><strong>Workout:</strong> 40 mins total: After a 5-min warm-up, spend 30 mins alternating between hard, moderate, and easy efforts. Finish with a 5-min cool-down.</div>" }, optional: { title: "Resilience Module", workout: "<div class='workout-component'><strong>Focus:</strong> Back Health.</div><div class='workout-component'><strong>Drill:</strong> 3 Rounds: 10 Cat-Cows, 10 Bird-Dogs per side, 30s Child's Pose.</div>"} } },
        "Week 4 (Deload)": { "Monday": { am: { title: "Full Body Recovery", purpose: "Promote blood flow, facilitate recovery, and practice movement patterns without accumulating fatigue.", cues: "Move with intention. This is not a workout to push; it's a session to move and feel good.", workout: "<div class='workout-component'><strong>0:00-5:00 | Warm-up:</strong> Light dynamic stretching.</div><div class='workout-component'><strong>5:00-40:00 | Main Work:</strong> 3 Rds For Quality: 8 DB Bench Press (30s), 10 Goblet Squats (35lb KB), 12 Ring Rows. Rest as needed.</div><div class='workout-component'><strong>40:00-45:00 | Cool-down:</strong> Full body foam roll.</div>" }, pm: { title: "Run", purpose: "Easy recovery jog.", cues: "Keep it light and easy.", workout: "<div class='workout-component'><strong>Workout:</strong> 20-25 minutes in <strong>HR Zone 1 (<158 bpm)</strong>.</div>" }, optional: { title: "Resilience Module", workout: "<div class='workout-component'><strong>Focus:</strong> Block 1C: Full Body Mobility & Activation.</div><div class='workout-component'><strong>Drill:</strong> 3 Rounds: 5 Inchworms, 10 Air Squats, 30s Dead Hang.</div>"} }, "Tuesday": { am: { title: "Full Body Recovery", purpose: "Continued recovery and light movement.", cues: "On the pull-up skill work, focus only on the feeling of muscular engagement. Do not strain.", workout: "<div class='workout-component'><strong>0:00-5:00 | Warm-up:</strong> Light dynamic stretching.</div><div class='workout-component'><strong>5:00-40:00 | Main Work:</strong> 3 Rds For Quality: 8 Sandbag Deadlifts (light), 8 DB Push Press (light), 10 Box Step-Ups (bodyweight). Pull-up Skill: 2 sets of 15s isometric holds.</div><div class='workout-component'><strong>40:00-45:00 | Cool-down:</strong> Full body stretching.</div>" }, pm: { title: "Optional Recovery Cardio", purpose: "Optional light flush.", cues: "Keep HR low.", workout: "<div class='workout-component'><strong>Workout:</strong> Total Rest or 20 minutes on Bike/Rower in <strong>HR Zone 1</strong>.</div>" }, optional: { title: "Resilience Module", workout: "<div class='workout-component'><strong>Focus:</strong> Block 1A: Upper Body Mobility & Activation.</div><div class='workout-component'><strong>Drill:</strong> 3 Rounds: 10 Band Pull-Aparts, 10 Scapular Push-ups, 5 Thoracic Rotations per side.</div>"} }, "Wednesday": { am: { title: "Full Body Recovery", purpose: "Low-intensity circuit to keep the body moving.", cues: "The pace should be conversational. Think of this AMRAP as a moving meditation.", workout: "<div class='workout-component'><strong>0:00-5:00 | Warm-up:</strong> Light dynamic stretching.</div><div class='workout-component'><strong>5:00-40:00 | Main Work:</strong> AMRAP 30 min (easy pace): 50m Farmer's Carry (light), 10 KB Swings, 10 HRPU, 45s Plank.</div><div class='workout-component'><strong>40:00-45:00 | Cool-down:</strong> Full body stretching.</div>" }, pm: { title: "Run", purpose: "Easy recovery jog.", cues: "Focus on relaxed breathing.", workout: "<div class='workout-component'><strong>Workout:</strong> 20 minutes in <strong>HR Zone 1-2</strong>.</div>" }, optional: { title: "Resilience Module", workout: "<div class='workout-component'><strong>Focus:</strong> Block 1B: Lower Body Mobility & Activation.</div><div class='workout-component'><strong>Drill:</strong> 3 Rounds: 10 Glute Bridges, 10 Fire Hydrants per side, 30s Deep Squat Hold.</div>"} }, "Thursday": { am: { title: "Active Recovery Ruck", purpose: "A walk to flush the legs, not a workout.", cues: "Use a lighter pack than prescribed (25 lbs).", workout: "<div class='workout-component'><strong>Workout:</strong> Ruck for 45 minutes with 25 lbs. Keep HR in <strong>Zone 1</strong>.</div>" }, pm: { title: "Optional: Total Rest", purpose: "Full recovery.", cues: "Rest is productive.", workout: "<div class='workout-component'><strong>Workout:</strong> Total Rest.</div>" }, optional: { title: "Resilience Module", workout: "<div class='workout-component'><strong>Focus:</strong> Back Health.</div><div class='workout-component'><strong>Drill:</strong> 3 Rounds: 10 Cat-Cows, 10 Bird-Dogs per side, 30s Child's Pose.</div>"} }, "Friday": { am: { title: "Full Body Recovery", purpose: "Final recovery session to prepare for the next block.", cues: "End the week feeling good. Focus on perfect technique.", workout: "<div class='workout-component'><strong>0:00-5:00 | Warm-up:</strong> Light dynamic stretching.</div><div class='workout-component'><strong>5:00-40:00 | Main Work:</strong> 3 Rds For Quality: 8 Sandbag Front Squats (light), 10 DB Rows/side (light), 15 Band Pull-Aparts. Pull-up Skill: 2 sets of 5 scapular pulls + 10s active hang.</div><div class='workout-component'><strong>40:00-45:00 | Cool-down:</strong> Full body foam roll.</div>" }, pm: { title: "Run or Ruck", purpose: "Light movement to finish the week.", cues: "Easy effort.", workout: "<div class='workout-component'><strong>Workout:</strong> 20-30 minute easy walk or light jog.</div>" }, optional: { title: "Resilience Module", workout: "<div class='workout-component'><strong>Focus:</strong> Block 1C: Full Body Mobility & Activation.</div><div class='workout-component'><strong>Drill:</strong> 3 Rounds: 5 Inchworms, 10 Air Squats, 30s Dead Hang.</div>"} } }
    };
    
    // This function will run once the entire page is loaded
    function initializeApp() {
        const weekTabsContainer = document.getElementById('week-tabs');
        const dayTabsContainer = document.getElementById('day-tabs');
        const contentArea = document.getElementById('workout-content-area');
        const principlesContainer = document.querySelector('.principles-container');
        const principlesToggle = document.querySelector('.principles-toggle');
        const principlesContent = document.querySelector('.principles-content');
        const clearButton = document.getElementById('clear-all-data');

        function renderPrinciples() {
            principlesContent.innerHTML = `
                <div class="principle-item"><h5>1. The "Athlete Input" Principle: Autoregulation</h5><p>Adjust your training based on how you feel <strong>today</strong>. Before each AM session, rate your readiness from 1-5 (1=Wrecked, 3=Normal, 5=Peak).</p><ul><li><strong>Score 1-2:</strong> Lower the prescribed RPE by 1-2 points. Focus on technique.</li><li><strong>Score 3:</strong> Execute the plan as written.</li><li><strong>Score 4-5:</strong> You have a "green light." Push the weight to match the true RPE feel.</li></ul></div>
                <div class="principle-item"><h5>2. The "Fuel and Repair" Protocol: Recovery</h5><p>Performance is built outside the gym. Your results depend on this.</p><ul><li><strong>Hydration:</strong> Drink half your body weight in ounces of water daily, plus more during training.</li><li><strong>Nutrition:</strong> Eat a palm-sized portion of lean protein with every meal. Consume protein/carbs within 60 minutes post-workout.</li><li><strong>Sleep:</strong> This is non-negotiable. Aim for <strong>7-9 hours of quality sleep</strong> per night.</li></ul></div>
                <div class="principle-item"><h5>3. The "Measure to Manage" Protocol: Week 0 Assessment</h5><p>Before starting Week 1, establish your baseline metrics to make progress tangible.</p><ul><li>Max reps Hand Release Push-ups (HRPU) in 2 mins.</li><li>Max duration Plank hold.</li><li>Timed 2-mile run for best effort.</li><li>Timed 4-mile ruck with 35 lbs.</li><li>Find your 5-Rep Max (5RM) on the Sandbag Front Squat and Vitruvian Deadlift.</li></ul></div>
                <div class="principle-item"><h5>4. The Long View: Understanding the Macrocycle</h5><p>Know why you're training today. Each block builds on the last.</p><ul><li><strong>Block 1 (1-4):</strong> Foundation & Skill Acquisition</li><li><strong>Block 2 (5-8):</strong> Strength & Power</li><li><strong>Block 3 (9-12):</strong> AFT Specificity & Peaking</li><li><strong>Block 4 (13-16):</strong> Taper & Test</li></ul></div>`;
        }

        function renderAllContent() {
            let fullHtml = '';
            Object.keys(plan).forEach((week, weekIndex) => {
                Object.keys(plan[week]).forEach((day, dayIndex) => {
                    const dayData = plan[week][day];
                    const contentId = `content-w${weekIndex+1}-d${dayIndex+1}`;
                    fullHtml += `<div class="day-content-wrapper" id="${contentId}">`;
                    if (dayData.am) { fullHtml += `<div class="session am"><h4 class="session-title am">AM: ${dayData.am.title}</h4><h5>Purpose & Goal:</h5><p>${dayData.am.purpose}</p><h5>Cues & Tips:</h5><p>${dayData.am.cues}</p>${dayData.am.workout}<div class="log-section"><label for="log-${contentId}-am">Log AM Results:</label><textarea class="log-input" id="log-${contentId}-am" rows="3"></textarea></div></div>`; }
                    if (dayData.pm) { fullHtml += `<div class="session pm"><h4 class="session-title pm">PM: ${dayData.pm.title}</h4><h5>Purpose & Goal:</h5><p>${dayData.pm.purpose}</p><h5>Cues & Tips:</h5><p>${dayData.pm.cues}</p>${dayData.pm.workout}<div class="log-section"><label for="log-${contentId}-pm">Log PM Results:</label><textarea class="log-input" id="log-${contentId}-pm" rows="3"></textarea></div></div>`; }
                    if (dayData.optional) { fullHtml += `<div class="session opt"><h4 class="session-title opt">Optional: ${dayData.optional.title}</h4>${dayData.optional.workout}<div class="log-section"><label for="log-${contentId}-opt">Log Optional Module Results:</label><textarea class="log-input" id="log-${contentId}-opt" rows="2"></textarea></div></div>`; }
                    fullHtml += '</div>';
                });
            });
            contentArea.innerHTML = fullHtml;
        }

        function renderTabs() {
            let weekHtml = '';
            Object.keys(plan).forEach((week, index) => {
                weekHtml += `<button data-week="${index+1}">${week.replace(' (Deload)', '')}</button>`;
            });
            weekTabsContainer.innerHTML = weekHtml;

            let dayHtml = '';
            Object.keys(plan['Week 1']).forEach((day, index) => {
                dayHtml += `<button data-day="${index+1}">${day.substring(0,3)}</button>`;
            });
            dayTabsContainer.innerHTML = dayHtml;
        }

        function showDay(weekNum, dayNum) {
            document.querySelectorAll('.day-content-wrapper').forEach(el => el.style.display = 'none');
            const targetContent = document.getElementById(`content-w${weekNum}-d${dayNum}`);
            if(targetContent) targetContent.style.display = 'block';

            document.querySelectorAll('#week-tabs button').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`#week-tabs button[data-week="${weekNum}"]`).classList.add('active');
            
            document.querySelectorAll('#day-tabs button').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`#day-tabs button[data-day="${dayNum}"]`).classList.add('active');
        }

        function handleTabClick(event) {
            const target = event.target;
            if (target.tagName !== 'BUTTON') return;
            
            const currentActiveWeek = document.querySelector('#week-tabs button.active').dataset.week;
            const currentActiveDay = document.querySelector('#day-tabs button.active').dataset.day;

            const newWeek = target.dataset.week || currentActiveWeek;
            const newDay = target.dataset.day || currentActiveDay;

            showDay(newWeek, newDay);
        }
        
        function handleTimestamp(event) {
            const textarea = event.target;
            if (textarea.value.trim() === '' && !textarea.dataset.timestamped) {
                const now = new Date();
                const timestamp = `[${now.toLocaleDateString()}, ${now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}]\n`;
                textarea.value = timestamp + textarea.value;
                textarea.dataset.timestamped = 'true';
            }
        }
        
        renderPrinciples();
        renderAllContent();
        renderTabs();

        document.querySelector('.main-nav').addEventListener('click', handleTabClick);
        
        principlesToggle.addEventListener('click', () => {
            principlesContainer.classList.toggle('active');
            principlesContent.style.maxHeight = principlesContainer.classList.contains('active') ? principlesContent.scrollHeight + "px" : '0';
        });
        
        const logInputs = document.querySelectorAll('.log-input');
        logInputs.forEach(input => {
            const storedValue = localStorage.getItem(input.id);
            if (storedValue) {
                input.value = storedValue;
                if(input.value.trim() !== '') input.dataset.timestamped = 'true';
            }
            input.addEventListener('focus', handleTimestamp, { once: true });
            input.addEventListener('input', () => {
                localStorage.setItem(input.id, input.value);
            });
        });

        clearButton.addEventListener('click', () => {
            if (confirm('Are you sure you want to delete all logged data? This cannot be undone.')) {
                localStorage.clear();
                logInputs.forEach(input => {
                    input.value = '';
                    delete input.dataset.timestamped;
                     input.addEventListener('focus', handleTimestamp, { once: true });
                });
                alert('All logged data has been cleared.');
            }
        });

        showDay(1, 1);
        principlesContainer.classList.add('active');
        principlesContent.style.maxHeight = principlesContent.scrollHeight + "px";
    }

    initializeApp();
});
